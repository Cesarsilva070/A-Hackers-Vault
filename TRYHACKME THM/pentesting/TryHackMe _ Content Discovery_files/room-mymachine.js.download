const attackBoxEl=document['querySelector']('#room-attackbox'),attackBoxControlOpsEl=document['querySelector']('#attackbox-machine-options'),roomDetailsEl=document['querySelector']('#room-details'),roomContentEl=document['querySelector']('#room-content'),roomGridContentEl=document['querySelector']('#room-content-main'),roomGridAttackboxEl=document['querySelector']('#room-content-attackbox'),attackBoxLoadingEl=document['querySelector']('#room-attackbox-loading'),attackBoxVMViewEl=document['querySelector']('#room-attackbox-vm-view'),attackBoxInstanceEl=document['querySelector']('#attackbox-machine-instance'),attackBoxURLBtn=document['querySelector']('#room-attackbox-url'),attackBoxExpireTxt=document['querySelector']('#room-attackbox-expire-text'),attackBoxStartBtn=document['querySelector']('#browser-machine-start'),attackBoxOptions=document['querySelector']('#browser-machine-options'),attackBoxSplitScreenBtn=document['querySelector']('#browser-machine-split-view'),attackBoxTabs=document['querySelector']('#room-attackbox-tabs'),machinePrivIpEl=document['querySelector']('#browser-machine-privip'),machinePubIpEl=document['querySelector']('#browser-machine-pubip'),machineUsername=document['querySelector']('#browser-username'),machinePassword=document['querySelector']('#browser-password'),machineProtocol=document['querySelector']('#browser-protocol'),freeAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'freeattackbox','text':'Free\x20TryHackMe\x20AttackBox'},subAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'kali','text':'TryHackMe\x20AttackBox'},subKaliInfo={'uploadId':'5f3a9d6842e1ab8a6de7f291','roomCode':'kali','text':'Kali\x20Linux'};let myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo};subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo);let abConfig={'deploying':![],'deployed':![]},attackBoxExpireTimer,attackBoxInitCounter,webBasedInstances={},webBasedTab={'attackbox':![],'instanceId':null};function changeMyMachine(_0x5c1065){attackBoxStartBtn['disabled']=![];if(_0x5c1065=='kali-linux')myMachineSelected={'title':'Kali\x20Linux','id':'kali-linux','machineInfo':subKaliInfo};else _0x5c1065=='attackbox'&&(myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo},subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo));_0x5c1065!='loading'?attackBoxStartBtn['innerHTML']='<i\x20class=\x22far\x20fa-laptop\x22></i>\x20Start\x20'+myMachineSelected['title']:(attackBoxStartBtn['disabled']=!![],attackBoxStartBtn['innerHTML']='<div\x20class=\x27d-flex\x20align-items-center\x27>\x0a\x20\x20\x20\x20\x20\x20<span\x20class=\x22spinner-border\x20spinner-border-sm\x20mr-2\x22\x20role=\x22status\x22\x20aria-hidden=\x22true\x22></span>\x20Starting...\x0a\x20\x20\x20\x20</div>');}function addWebBasedMachine(_0x564b6a){const _0x38cd98=_0x564b6a['instanceId'];webBasedInstances[_0x38cd98]=_0x564b6a,renderAttackBoxTabHTML();}function renderAttackBoxTabHTML(){attackBoxTabs['innerHTML']='';for(const [_0x307e48,_0x2edf9a]of Object['entries'](webBasedInstances)){const _0x1efaf0=Object['keys'](webBasedInstances)['length']==0x1?'tab-active':'';attackBoxTabs['innerHTML']+='<div\x20class=\x22'+_0x1efaf0+'\x22\x20data-id=\x22'+_0x307e48+'\x22\x20onclick=\x22switchWebBasedTab(\x27'+_0x307e48+'\x27)\x22>'+_0x2edf9a['title']+'<div>';}}function switchWebBasedTab(_0x369553){attackBoxVMViewEl['style']['height']='',clearInterval(attackBoxExpireTimer),clearInterval(attackBoxInitCounter),switchWebBasedMachine(_0x369553);}function initWebBasedMachine(_0x3539d3){setAttackBoxDetails('online');if(_0x3539d3['type']!='static-site'){attackBoxControlOpsEl['className']='',attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']='',renderAttackBox(_0x3539d3['title'],_0x3539d3['internalIP'],_0x3539d3['remote']['privateIp'],_0x3539d3['timeInSeconds'],_0x3539d3['created'],_0x3539d3['remote'],_0x3539d3['username'],_0x3539d3['password'],_0x3539d3['waitTime']);_0x3539d3['roomId']==myMachineSelected['machineInfo']['roomCode']?webBasedTab['attackbox']=!![]:webBasedTab['attackbox']=![];webBasedTab['instanceId']=_0x3539d3['instanceId'];const _0x23b2d6=webBasedTab['attackbox']?'attackbox':'webbased';setNavConnStatus({'type':_0x23b2d6,'virtualIP':_0x3539d3['remote']['privateIp']});}else renderiFrameHTML(_0x3539d3['url']),attackBoxControlOpsEl['className']='rem-attackbox-machine-options',setNavConnStatus({'type':'hide'});const _0x3550f8=document['querySelectorAll']('#room-attackbox-tabs\x20>\x20div');for(let _0x2c71f7 of _0x3550f8){_0x2c71f7['className']='';if(_0x2c71f7['dataset']['id']==_0x3539d3['instanceId'])_0x2c71f7['className']='tab-active';}}function switchWebBasedMachine(_0x4b8b96){const _0x8b01fe=webBasedInstances[_0x4b8b96];if(_0x8b01fe!=undefined)initWebBasedMachine(_0x8b01fe);}function startAttackBox(_0x23d6b6){if(!abConfig['deploying']){abConfig['deploying']=!![],changeMyMachine('loading'),$['post']('/account/dashboard/deploy-kali');if(_0x23d6b6['startingMsg'])displayMessages('','warning','Starting\x20your\x20machine..\x20please\x20wait!');$['post']('/material/deploy',{'id':myMachineSelected['machineInfo']['uploadId'],'roomCode':myMachineSelected['machineInfo']['roomCode']},async function(_0x596ada){changeMyMachine(myMachineSelected['id']),_0x596ada['success']?(addWebBasedMachine(_0x596ada),initWebBasedMachine(_0x596ada),attackboxEvent('room_page',myMachineSelected['machineInfo']['text']),displayMessages('Hooray!','success',_0x596ada['msg']),showSplitScreenBtn('none'),showAttackStartBoxBtn('none'),abConfig['deployed']=!![],_0x23d6b6['tutorial']&&setTimeout(startIntroAttackBoxDeploy,0x1f4)):(displayMessages('Uh-oh!','danger',_0x596ada['msg']),showAttackStartBoxBtn('show')),abConfig['deploying']=![];});}else displayMessages('','warning','Please\x20wait,\x20your\x20machine\x20is\x20still\x20loading..');}async function extendHourWebBasedVM(_0x512eca){let _0x377154;if(webBasedTab['attackbox']&&_0x512eca==null)_0x377154=extendAttackBox();else{_0x377154=await addRoomVMHour();if(_0x377154!=null)extendWebBasedTimer(_0x377154);}const _0x19b839=_0x512eca!=null?_0x512eca:webBasedTab['instanceId'];if(_0x377154!=null){let _0x36a5ed=webBasedInstances[_0x19b839];_0x36a5ed['timeInSeconds']=_0x377154;}}function terminateWebBasedVM(_0x136809){webBasedTab['attackbox']&&_0x136809==null?terminateAttackBox():terminateRoomVM(),remWebBasedTabData(_0x136809);}function remWebBasedTabData(_0x3babd1){const _0x1aacf5=_0x3babd1!=null?_0x3babd1:webBasedTab['instanceId'];delete webBasedInstances[_0x1aacf5],Object['keys'](webBasedInstances)['length']==0x0?(setAttackBoxDetails('offline'),getNavConnOpenVPN()):setTimeout(function(){const _0x8bb20=Object['keys'](webBasedInstances)[0x0];switchWebBasedTab(_0x8bb20),renderAttackBoxTabHTML();},0x64);}function terminateAttackBox(){displayMessages('','success','Your\x20machine\x20has\x20been\x20terminated.'),$['post']('/api/vm/terminate',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x47f379){clearInterval(attackBoxExpireTimer),_0x47f379['success']?(showAttackStartBoxBtn('show'),abConfig['deployed']=![]):displayMessages('Uh-oh!','warning',_0x47f379['msg']);});}function extendAttackBox(){return new Promise((_0x54ddfe,_0x2b0d89)=>{$['post']('/api/vm/renew',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x3001aa){return _0x3001aa['success']?(displayMessages('','success','Successfully\x20updated\x20your\x20machines\x20expiry\x20time.'),extendWebBasedTimer(_0x3001aa['timeInSeconds']),_0x54ddfe(_0x3001aa['timeInSeconds'])):(displayMessages('Uh-oh!','warning',_0x3001aa['msg']),_0x54ddfe());});});}function extendWebBasedTimer(_0x1f7411){clearInterval(attackBoxExpireTimer),attackBoxExpireTimer=startAttackBoxTimer(_0x1f7411,attackBoxExpireTxt,'my-machine',attackBoxExpireTimer);}async function getModalAttackBoxPubIP(){const _0x14d937=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x14d937['success']?machinePubIpEl['textContent']=_0x14d937['data']['internalIP']:machinePubIpEl['textContent']='-';}async function getAttackBoxStatus(){const _0x5d0b31=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x5d0b31['success']?(showAttackStartBoxBtn('none'),addWebBasedMachine(_0x5d0b31['data']),userObj['splitScreen']==!![]?(initWebBasedMachine(_0x5d0b31['data']),showSplitScreenBtn('none')):showSplitScreenBtn('show'),setNavConnStatus({'type':'attackbox','virtualIP':_0x5d0b31['data']['remote']['privateIp']}),abConfig['deployed']=!![]):(showAttackStartBoxBtn('show'),await getNavConnOpenVPN());}function showAttackStartBoxBtn(_0x2bce80){_0x2bce80=='show'&&!roomSettings['remAttackBoxBtn']?attackBoxOptions['style']['display']='inline-flex':attackBoxOptions['style']['display']='none';}function showSplitScreenBtn(_0x182b6a){_0x182b6a=='show'?attackBoxSplitScreenBtn['style']['display']='inline-flex':attackBoxSplitScreenBtn['style']['display']='none';}attackBoxSplitScreenBtn['onclick']=function(){showSplitScreenView();},attackBoxStartBtn['onclick']=function(){setSplitScreenSetting(!![]),startAttackBox({'startingMsg':!![],'tutorial':![]});};function setSplitScreenSetting(_0x45867a){setUserSetting('room','splitScreen',_0x45867a),userObj['splitScreen']=_0x45867a;}function exitViewAttackBox(){setSplitScreenSetting(![]),setAttackBoxDetails('offline'),showSplitScreenBtn('show');}function showSplitScreenView(){setSplitScreenSetting(!![]),setAttackBoxDetails('online'),showSplitScreenBtn('none'),switchWebBasedTab(Object['keys'](webBasedInstances)[0x0]);}function infoAttackBox(){$('#attackBoxInfoModal')['modal']('toggle');}function setAttackBoxDetails(_0x17396d){_0x17396d=='online'?(roomContentEl['className']='room-flex',roomGridContentEl['className']='room-splitscreen-content',roomGridAttackboxEl['className']='room-attackbox',attackBoxLoadingEl['style']['display']='block',attackBoxEl['style']['display']='grid',roomLite('lite')):(attackBoxEl['style']['display']='none',roomContentEl['className']='',roomGridContentEl['className']='',roomGridContentEl['style']='',roomGridAttackboxEl['className']='',attackBoxVMViewEl&&(attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']=''),roomLite('regular'));}function renderAttackBox(_0x34f2bd,_0x533c3f,_0x3d43c6,_0x1e5c60,_0xa3d6f2,_0x34dceb,_0x97c51d,_0x3909de,_0x16df4e){extendWebBasedTimer(_0x1e5c60),checkAttackBoxDeploy(_0x34f2bd,_0x533c3f,_0x1e5c60,_0xa3d6f2,_0x34dceb),machinePubIpEl['textContent']=_0x533c3f!=null?_0x533c3f:'-',machinePrivIpEl['textContent']=_0x3d43c6,machineUsername['textContent']=_0x97c51d?_0x97c51d:'N/a',machinePassword['textContent']=_0x3909de?_0x3909de:'N/a',machineProtocol['textContent']=_0x34dceb['protocol'];}async function checkAttackBoxDeploy(_0x59db10,_0x36fffc,_0x18383d,_0x47584e,_0x218479){if(_0x218479['active']){let _0x46cacc=0x1;_0x218479['bootTime']&&(_0x46cacc=_0x218479['bootTime']);const _0x321347=_0x218479['remoteUrl'];attackBoxURLBtn['href']=_0x321347,attackBoxTimer(_0x47584e,_0x46cacc,'deploy-browser',_0x321347,_0x36fffc),attackBoxLoadingEl['innerHTML']='<div\x20id=\x22machine-loading-attackbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loading-msg\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x27>Your\x20machine\x20is\x20initializing...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x20faded\x27>Use\x20the\x20AttackBox\x20to\x20attack\x20machines\x20you\x20start\x20on\x20tasks</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22machine-loading-attackbox-progress\x22\x20class=\x22progress-bar\x20bg-success\x22\x20style=\x22width:0%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>';}}function renderiFrameHTML(_0x3980ce){attackBoxVMViewEl['innerHTML']='<iframe\x20style=\x22position:\x20static;\x22\x20id=\x22remote-connection-2\x22\x20onmouseover=\x22setRemote2ConnectionFocus()\x22\x20src=\x22'+_0x3980ce+'\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20frameBorder=\x220\x22\x20allow=\x22fullscreen\x22>Browser\x20not\x20compatible.</iframe>',attackBoxVMViewEl['style']['height']='100%',attackBoxLoadingEl['style']['display']='none';}let webBasedLoadingSecs;async function attackBoxTimer(_0x2576b8,_0x1c31ba,_0x59aae6,_0x39b1ef,_0x42fed9){var _0xf603ea=new Date(_0x2576b8);_0xf603ea['setMinutes'](_0xf603ea['getMinutes']()+_0x1c31ba);attackBoxInitCounter&&clearInterval(attackBoxInitCounter);const _0x55dfe4=await getServerTime();webBasedLoadingSecs=((_0xf603ea['getTime']()-_0x55dfe4['getTime']())/0x3e8)['toFixed'](0x0),attackBoxLoadingScreen(_0x1c31ba,_0x42fed9,_0x39b1ef),webBasedLoadingSecs>0x0&&(attackBoxInitCounter=setInterval(async function(){attackBoxLoadingScreen(_0x1c31ba,_0x42fed9,_0x39b1ef);},0x3e8));}function attackBoxLoadingScreen(_0x21c353,_0x4d629a,_0x3a2a3b){webBasedLoadingSecs--;if(webBasedLoadingSecs<0x0){clearInterval(attackBoxInitCounter);const _0x17e4d4=document['querySelector']('#machine-loading-attackbox');if(_0x17e4d4)_0x17e4d4['outerHTML']='';attackBoxURLBtn['className']='clear-link',attackBoxURLBtn['innerHTML']='<div><i\x20class=\x22far\x20fa-expand-alt\x22></i></div>',machinePubIpEl['innerHTML']=_0x4d629a!=null?_0x4d629a:'<div\x20onclick=\x27getModalAttackBoxPubIP()\x27>Reveal\x20IP</div>',renderiFrameHTML(_0x3a2a3b);}else{attackBoxURLBtn['className']='clear-link\x20disabled',attackBoxURLBtn['innerHTML']='<div\x20class=\x27faded\x27>Access\x20desktop\x20in\x20'+webBasedLoadingSecs+'s</div>';const _0x33eb1f=document['querySelector']('#machine-loading-attackbox-progress'),_0x455df9=((0x1-(webBasedLoadingSecs/(_0x21c353*0x3c))['toFixed'](0x2))*0x64)['toFixed'](0x0);_0x33eb1f&&(_0x33eb1f['style']['width']=_0x455df9+'%',_0x33eb1f['textContent']=_0x455df9+'%');}}function setRemote2ConnectionFocus(){document['querySelector']('#remote-connection-2')['contentWindow']['focus']();}function startAttackBoxTimer(_0x12ec09,_0x5cf2eb,_0x4e14cf,_0x44939e){let _0x54dc02=parseInt(_0x12ec09),_0x4ca0fb=_0x54dc02,_0x299313,_0x1fcc4,_0x2ba73f;return _0x44939e=setInterval(function(){_0x299313=parseInt(_0x4ca0fb/0x3c,0xa)%0x3c,_0x1fcc4=parseInt(_0x4ca0fb%0x3c,0xa),_0x2ba73f=parseInt(_0x4ca0fb/0xe10,0xa),_0x299313=_0x299313<0xa?'0'+_0x299313:_0x299313,_0x1fcc4=_0x1fcc4<0xa?'0'+_0x1fcc4:_0x1fcc4,_0x2ba73f=_0x2ba73f<0xa?'0'+_0x2ba73f:_0x2ba73f;let _0x4e52e9=parseInt(_0x2ba73f)['toFixed'](0x0)+'h\x20'+_0x299313+'m\x20'+_0x1fcc4+'s';_0x2ba73f==0x0&&(_0x4e52e9=_0x299313+'m\x20'+_0x1fcc4+'s'),_0x5cf2eb['textContent']=_0x4e52e9,--_0x4ca0fb<0x0&&(_0x4ca0fb=_0x54dc02);},0x3e8),_0x44939e;}function roomLite(_0x3eb54a){const _0x5a24a9=document['querySelector']('.navbar-main'),_0x24254b='navbar-lite';if(_0x3eb54a=='lite'){if(_0x5a24a9&&!_0x5a24a9['className']['includes'](_0x24254b))_0x5a24a9['classList']['toggle'](_0x24254b);roomDetailsEl['className']='shorten-room-details';}else{if(_0x5a24a9&&_0x5a24a9['className']['includes'](_0x24254b))_0x5a24a9['classList']['toggle'](_0x24254b);roomDetailsEl['className']='';}}